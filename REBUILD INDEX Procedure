--REBUILD INDEX

BEGIN TRY   

DECLARE @TABLE NVARCHAR(MAX)
,@CMD NVARCHAR(MAX)
,@MSG VARCHAR(MAX)
,@DATABASE NVARCHAR(MAX)

SET @DATABASE=DB_NAME() 

SET @CMD = 'DECLARE TABLECURSOR CURSOR READ_ONLY FOR SELECT ''['' + TABLE_CATALOG + ''].['' + TABLE_SCHEMA + ''].[''+TABLE_NAME+'']'' AS TABLENAME FROM [' + @DATABASE + '].INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = ''BASE TABLE'' ORDER BY ''['' + TABLE_CATALOG + ''].['' + TABLE_SCHEMA + ''].[''+TABLE_NAME+'']'''
EXEC (@CMD)OPEN TABLECURSOR   

FETCH NEXT FROM TABLECURSOR INTO @TABLE 
WHILE @@FETCH_STATUS = 0 
BEGIN
	SET @CMD ='ALTER INDEX ALL ON ' + @TABLE + ' REBUILD'
	SET @MSG=N''+@CMD+' TIME '+CONVERT(VARCHAR(50),GETDATE(),113); RAISERROR(@MSG, 0, 1) WITH NOWAIT;
	EXEC (@CMD)

    FETCH NEXT FROM TABLECURSOR INTO @TABLE
END
CLOSE TABLECURSOR   
DEALLOCATE TABLECURSOR 

END TRY
     
BEGIN CATCH
	SET @MSG=ERROR_MESSAGE()
	SET @MSG=@MSG + ' COMMAND : '+@CMD 
	SET @MSG=N' TIME '+@MSG+CONVERT(VARCHAR(50),GETDATE(),113); RAISERROR(@MSG, 0, 1) WITH NOWAIT;
END CATCH
